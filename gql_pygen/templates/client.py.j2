"""Generated GraphQL client for {{ client_name }}.

Provides typed methods for GraphQL operations.
"""
{% if operations %}
from typing import Any
{% endif %}
from .base_client import GraphQLClient
from ..models import *


class {{ client_name }}Client:
    """GraphQL client for {{ client_name }} operations."""

    def __init__(self, client: GraphQLClient):
        self.client = client
{%- for op in operations %}
    {#- Sort arguments: required first, optional last -#}
    {%- set required_args = op.arguments | selectattr('is_optional', 'false') | list -%}
    {%- set optional_args = op.arguments | selectattr('is_optional', 'true') | list -%}
    {%- set sorted_args = required_args + optional_args %}

    def {{ op.name | snake_case }}(
        self,
        {%- for arg in sorted_args %}
        {{ arg.name | snake_case | safe_param }}: {% if arg.is_list %}list[{{ arg.type_name }}]{% else %}{{ arg.type_name }}{% endif %}{% if arg.is_optional %} | None = None{% endif %},
        {%- endfor %}
    ) -> {% if op.is_return_list %}list[{{ op.return_type }}]{% else %}{{ op.return_type }}{% endif %}{% if op.is_return_optional %} | None{% endif %}:
        """{{ op.description or op.name }}"""
        {%- set field_selection = op.return_type | expand_fields %}
        query = """
        {{ op.operation_type }} {{ op.name | pascal_case }}(
            {%- for arg in op.arguments %}
            ${{ arg.name }}: {% if arg.is_list %}[{% endif %}{{ arg.type_name }}{% if not arg.is_optional %}!{% endif %}{% if arg.is_list %}]{% endif %}{% if not loop.last %},{% endif %}
            {%- endfor %}
        ) {
            {{ op.name }}(
                {%- for arg in op.arguments %}
                {{ arg.name }}: ${{ arg.name }}{% if not loop.last %},{% endif %}
                {%- endfor %}
            ){% if field_selection %} {
                {{ field_selection }}
            }{% endif %}
        }
        """
        variables: dict[str, Any] = {
            {%- for arg in op.arguments %}
            "{{ arg.name }}": {{ arg.name | snake_case | safe_param }},
            {%- endfor %}
        }
        # Remove None values
        variables = {k: v for k, v in variables.items() if v is not None}
        result = self.client.execute(query, variables)
        data = result.get("{{ op.name }}")
        if data is None:
            return None
{%- if op.is_return_list %}
        return [{{ op.return_type }}.model_validate(item) for item in data]
{%- else %}
        return {{ op.return_type }}.model_validate(data)
{%- endif %}
{%- endfor %}
